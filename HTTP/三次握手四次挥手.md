## 三次握手
- **第一次握手**：客户端给服务端发送请求报文，指定序列号 SYN = 1，ACK = 0，初始序号为 seq = x,同时 TCP 客户端进入 SYN-SENT(同步已发送)状态
- **第二次握手**：服务端接收到客户端发送的 SYN 报文，向客户端发送一个 SYN 报文作为应答，表示同意建立连接，同时制定自己的 SYN = 1，ACK = 1，同时会发送 seq = y，来表示自己的初始序号，确认号 ack = x + 1，服务端进入 SYN-RCVD （同步收到）状态。
- **第三次握手**：客户端收到后，再次向服务器发送确认信息，表示收到。此时 ACK = 1，seq = x + 1, ack = y + 1。TCP 连接建立，客户端服务端进入 ESTAB-LISTEND （已建立连接）状态


- 最开始双方都处于 CLOSED 状态，服务器开始监听某个端口，变成 LISTEN 状态
- 客户端发起链接，发送 SYN，客户端变为 SYN-SENT 状态
- 服务端收到，返回 SYN 和 ACK，客户端变为 SYN-RCVD 状态
- 客户端再发送 ACK 给服务端，客户端变为 ESTABLISHED 状态
- 服务端接受到 ACK 变为 ESTABLISHED 状态

## 四次挥手
- **第一次挥手**：客户端主动断开连接，向服务端发送 FIN 报文段，即释放报文段，并且状态变为 FIN-WAIT-1
- **第二次挥手**：服务端收到 FIN 报文，向客户端发送 ACK = 1，seq = y,ack = u + 1 的报文段，表示自己已经收到了请求报文，状态变为 CLOSE-WAIT 状态
- **第三次挥手**：等待一段时间，当服务端将剩余数据发送完后，也会向客户端发送一个 FIN = 1 的报文段，同时进入 LAST_ACK（最后确认） 状态
- **第四次挥手**：客户端收到断开释放报文 FIN，向服务端发送 ACK = 1，seq = u + 1,ack = w + 1 的报文，进入 TIME-WAIT 状态，一段时间后，服务端收到客户端的响应报文，将自身状态变为 Closed，客户端等待 TIME-WAIT 时间后，也变为 Closed 状态

- 刚开始双方处于 ESTABLISHED 状态。
- 客户端要断开了，向服务器发送 FIN 报文
- 发送后客户端变成了 FIN-WAIT-1 状态。注意, 这时候客户端同时也变成了 half-close(半关闭) 状态，即无法向服务端发送报文，只能接收。
- 服务端接收后向客户端确认，变成了CLOSED-WAIT 状态
- 客户端接收了服务端的确认，变成了 FIN-WAIT-2 状态
- 服务端向客户端发送 FIN ，进入 LAST-ACK 状态
- 客户端收到服务端发来的 FIN 后，自己变成了 TIME-WAIT 状态，然后发送 ACK 给服务端
- 客户端需要等待足够长的时间，具体来说，是 2 个 MSL(Maximum Segment Lifetime，报文最大生存时间), 在这段时间内如果客户端没有收到服务端的重发请求，那么表示 ACK 成功到达，挥手结束，否则客户端重发 ACK。

### 问题
#### 为什么握三次手，握两次或者四次行不行？

#### 为什么最后一次挥手，客户端还要进入一个TIME-WAIT状态？

#### 等待2MSL的意义

#### 为什么是四次挥手而不是三次？
